<!--<!DOCTYPE html>-->
<!--<html lang="ko" xmlns:th="http://www.thymeleaf.org" >-->
<!--<div th:replace="~{/presentation/fragments/fragment-head :: head}"></div>-->


<!--  <body>-->

<!--  <div th:replace="~{/presentation/fragments/fragment-svg :: svg}"></div>-->

<!--    <div class="preloader-wrapper">-->
<!--      <div class="preloader">-->
<!--      </div>-->
<!--    </div>-->

<!--    <div th:replace="~{/presentation/fragments/fragment-header :: header(${username})}"></div>-->


<!--  <div class="container mt-5 mb-5">-->
<!--  <h2>스터디카페 실시간 자리 현황</h2>-->
<!--    남은 좌석 : <span th:text="${seatCount}"></span>-->
<!--    <div class="row">-->
<!--    &lt;!&ndash; 5행 반복 (1차원 배열을 8개씩 나누어 5x8로 출력) &ndash;&gt;-->
<!--    <div th:each="rowIndex : ${#numbers.sequence(0, 4)}" class="d-flex justify-content-center">-->
<!--      &lt;!&ndash; 좌석 4개 &ndash;&gt;-->
<!--      <div th:each="seat : ${seats.subList(rowIndex * 8, rowIndex * 8 + 4)}" class="seat"-->
<!--           th:classappend="${seat.isActive} ? 'isActive' : 'empty'">-->
<!--        <span class="seat-number" th:text="${seat.seatId}"></span>-->
<!--      </div>-->

<!--      &lt;!&ndash; 가운데 줄 마진을 포함하는 빈칸 &ndash;&gt;-->
<!--      <div class="seat-divider"></div>-->

<!--      &lt;!&ndash; 좌석 나머지 4개 &ndash;&gt;-->
<!--      <div th:each="seat : ${seats.subList(rowIndex * 8 + 4, rowIndex * 8 + 8)}" class="seat"-->
<!--           th:classappend="${seat.isActive} ? 'isActive' : 'empty'">-->
<!--        <span class="seat-number" th:text="${seat.seatId}"></span>-->
<!--      </div>-->
<!--    </div>-->
<!--  </div>-->
<!--  </div>-->

<!--  &lt;!&ndash; footer &ndash;&gt;-->
<!--  <div th:replace="~{presentation/fragments/fragment-footer :: footer}"></div>-->
<!--  <style>-->
<!--    .seat {-->
<!--      width: 50px;-->
<!--      height: 50px;-->
<!--      display: flex;-->
<!--      justify-content: center;-->
<!--      align-items: center;-->
<!--      border: 1px solid #ccc;-->
<!--      margin: 5px;-->
<!--    }-->
<!--    .isActive {-->
<!--      background-color: #ffcccc; /* 사용 중 좌석 색상 */-->
<!--    }-->
<!--    .empty {-->
<!--      background-color: #d3d3d3; /* 사용 가능 좌석 색상 */-->
<!--    }-->
<!--    .seat-number {-->
<!--      font-weight: bold;-->
<!--    }-->
<!--    /* 가운데 줄에 마진을 추가 */-->
<!--    .seat-divider {-->
<!--      margin-right: 20px; /* 빨간 줄에 해당하는 마진 */-->
<!--    }-->
<!--  </style>-->
<!--  </body>-->
<!--</html>-->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="~{/presentation/fragments/fragment-head :: head}"></div>
    <style>
        .seat {
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #ccc;
            margin: 5px;
            cursor: pointer; /* 커서를 포인터로 변경 */
        }
        .isActive {
            background-color: #ffcccc; /* 사용 중 좌석 색상 */
            border: 2px solid red; /* 붉은색 테두리 */
        }
        .empty {
            background-color: #d3d3d3; /* 사용 가능 좌석 색상 */
        }
        .seat-number {
            font-weight: bold;
        }
        /* 가운데 줄에 마진을 추가 */
        .seat-divider {
            margin-right: 20px; /* 빨간 줄에 해당하는 마진 */
        }
    </style>
</head>
<body>
<div th:replace="~{/presentation/fragments/fragment-svg :: svg}"></div>

<div class="preloader-wrapper">
    <div class="preloader"></div>
</div>

<div th:replace="~{/presentation/fragments/fragment-header :: header(${username})}"></div>

<div class="container mt-5 mb-5">
    <h2>스터디카페 실시간 자리 현황</h2>
    남은 좌석 : <span th:text="${seatCount}"></span>
    <div class="row">
        <div th:each="rowIndex : ${#numbers.sequence(0, 4)}" class="d-flex justify-content-center">
            <div th:each="seat : ${seats.subList(rowIndex * 8, rowIndex * 8 + 4)}" class="seat"
                 th:class="${seat.isActive} ? 'isActive' : 'empty'"
                 th:onclick="${!seat.isActive && !user.hasCheckedIn} ? 'selectSeat(' + seat.seatId + ')' : ''"
                 th:id="${seat.seatId}">
                <span class="seat-number" th:text="${seat.seatId}"></span>
            </div>

            <div class="seat-divider"></div>

            <div th:each="seat : ${seats.subList(rowIndex * 8 + 4, rowIndex * 8 + 8)}" class="seat"
                 th:class="${seat.isActive} ? 'isActive' : 'empty'"
                 th:onclick="${!seat.isActive && !user.hasCheckedIn} ? 'selectSeat(' + seat.seatId + ')' : ''"
                 th:id="${seat.seatId}">
                <span class="seat-number" th:text="${seat.seatId}"></span>
            </div>
        </div>
    </div>

    <!-- 입실 버튼 및 퇴실 버튼 -->
    <div class="text-center mt-4">
        <button id="checkInButton" class="btn btn-primary" th:if="${!user.hasCheckedIn}" th:text="'입실'">입실</button>
        <button id="checkOutButton" class="btn btn-danger" th:if="${user.hasCheckedIn}" th:text="'퇴실'">퇴실</button>
    </div>
</div>

<!-- footer -->
<div th:replace="~{presentation/fragments/fragment-footer :: footer}"></div>

<script>
    let selectedSeatId = null; // 선택된 좌석 ID

    // 좌석 선택 함수
    function selectSeat(seatId) {
        if (selectedSeatId) {
            // 이미 선택된 좌석이 있을 경우 붉은 테두리 제거
            const previousSeat = document.getElementById(selectedSeatId);
            if (previousSeat) {
                previousSeat.classList.remove('isActive');
            }
        }
        selectedSeatId = seatId; // 새로운 좌석 선택
        const selectedSeatElement = document.getElementById(seatId);
        selectedSeatElement.classList.add('isActive'); // 붉은 테두리 추가
    }

    // 입실 버튼 클릭 시 API 호출
    document.getElementById('checkInButton').addEventListener('click', function () {
        if (selectedSeatId) {
            fetch('/api/checkin/' + selectedSeatId, {
                method: 'POST',
            }).then(response => {
                if (response.ok) {
                    location.reload(); // 새로고침
                } else {
                    alert('입실 실패');
                }
            });
        } else {
            alert('좌석을 선택하세요.');
        }
    });

    // 퇴실 버튼 클릭 시 API 호출
    document.getElementById('checkOutButton').addEventListener('click', function () {
        fetch('/api/cafe/leave', {
            method: 'POST',
        }).then(response => {
            if (response.ok) {
                location.reload(); // 새로고침
            } else {
                alert('퇴실 실패');
            }
        });
    });
</script>
</body>
</html>
